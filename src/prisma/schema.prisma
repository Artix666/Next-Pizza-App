// Define database connection via the `DATABASE_URL` env var
datasource db {
  provider = "postgresql"
  url = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
  
}

model User {
  id Int @id @default(autoincrement())
  fullName String
  email    String @unique
  password String
  role UserRole @default(USER)
  verified DateTime
  provider  String?
  providerId String?
  basket Basket?
  Orders Order[]
  verificationCode VerificationCode?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}


model Category {
  id Int @id @default(autoincrement())
  name String @unique
  products Product[]

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model Product {
  id Int @id @default(autoincrement())

  name        String
  imageUrl    String

  ingredients Ingredient[]
  variants    Variations[]

  category Category @relation(fields: [categoryId], references: [id])
  categoryId Int

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model Variations{
  id Int @id @default(autoincrement())

  price Int
  size Int?
  pizzaType Int?

  product Product @relation(fields: [productId], references: [id])
  productId Int

  basketItems BasketItem[]
}



model Ingredient {
  id Int @id @default(autoincrement())

  name String @unique
  price Int
  imageUrl String

  products Product[]
  basketItems BasketItem[]

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model Basket {
  id Int @id @default(autoincrement())

  user User? @relation(fields: [userId], references: [id])
  userId Int? @unique
  items BasketItem[]
  token String? @unique

  totalPrice Int @default(0)

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model BasketItem {
  id Int @id @default(autoincrement())

  variation Variations @relation(fields: [variationId], references: [id])
  variationId Int
  basket Basket @relation(fields: [basketId], references: [id])
  basketId Int

  quantity Int 
  ingredients Ingredient[]
 
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model Order {
  id Int @id @default(autoincrement())
  user User? @relation(fields: [userId], references: [id])
  userId Int?

  token String @unique
  totalPrice Int
  status OrderStatus 
  paymentId String?

  items Json

  fullName String
  address String
  phone String
  email String
  comments String?

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}


model VerificationCode {
  id Int @id @default(autoincrement())
  user User @relation(fields: [userId], references: [id])
  userId Int @unique

  code String
  
  createdAt   DateTime @default(now())

  @@unique([userId, code])
  
}
enum OrderStatus {
  PENDING
  SUCCESS
  CANCELED
}

enum UserRole {
  USER
  ADMIN
}